---
title:  "Evaluate Returns"
author: <br><br><br><br><span style="font-family:perpetua; font-variant:small-caps; color:#606060;">Kerry Back</span><br><br><img src="RiceBusiness-transparent-logo-sm.png"  height=80>
execute:
  echo: false
  jupyter: python3
  cache: true
format: 
  revealjs:
    highlight-style: monokai
    code-fold: true
    code-copy: hover
    scrollable: true
    slide-number: true
    preview-links: true
    self-contained: true
    controls: true
    transition: fade
    theme: [solarized, 2023.scss]
    incremental: true
---

## Overview

- Suppose we've run a backtest and saved the portfolio returns.
- Evaluate raw returns: accumulation, drawdowns, mean, std dev, Sharpe ratio
- Evaluate relative to benchmarks
    - Compare to the market on a beta-adjusted basis
    - Compare to the market and other factors (attribution analysis)


## Drawdowns

- A drawdown occurs whenever your portfolio value is not as high as it once was
- The percent drawdown is (current value - prior max) / prior max.

## Statistics

- mean and std dev of monthly returns
- annualize mean by $\times$ 12
- annualize std dev by $\times$ sqrt(12)
- compute monthly excess returns (in excess of T-bill rate), mean and std dev and Sharpe ratio = mean / std dev
- annualize Sharpe ratio by $\times$ sqrt(12)

## Example accumulation plot

. . .

```{python}
import pandas as pd
import plotly.graph_objects as go
from pandas_datareader import DataReader as pdr

df = pd.read_csv("files/rets.csv", parse_dates=["date"], index_col="date")

ret = 1.5*df.best - 0.5*df.worst
ff = pdr("F-F_Research_Data_Factors", "famafrench", start=2005)[0]/100
mkt = ff["Mkt-RF"] + ff["RF"]
rf = ff["RF"]
df = pd.concat((ret, mkt, rf), axis=1)
df.index = pd.to_datetime(df.index.astype(str))
df.columns = ["ret", "mkt", "rf"]

trace1 = go.Scatter(
    x = df.index.to_list(),
    y = (1+df.ret).cumprod(),
    mode="lines",
    name="150-50 return",
    hovertemplate="%{x}<br>accumulation = $%{:.2f}<extra><\extra"
)

trace2 = go.Scatter(
    x = df.index.to_list(),
    y = (1+df.mkt).cumprod(),
    mode="lines",
    name="market return",
    hovertemplate="%{x}<br>accumulation = $%{:.2f}<extra><\extra>"
)

fig = go.Figure(trace1)
fig.add_trace(trace2)
fig.update_layout(
    yaxis_title="",
    xaxis_title_font = {"size":18},
    template="plotly_white",
    yaxis_tickprefix="$",
    yaxis_tickformat=".2f",
    height=600,  
    width=1000,
    legend=dict(
      x = 0.01,
      y = 0.99
    ),
    font_size=16
)
fig.show()
```


## Example drawdown plot

```.p
accum = (1+ret).cumprod()
accum_max = accum.expanding().max()
drawdown = accum/accum_max - 1
```
. . .

![](drawdown.png)





